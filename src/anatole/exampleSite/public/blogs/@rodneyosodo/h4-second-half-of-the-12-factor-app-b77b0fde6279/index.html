<!doctype html><html dir=ltr lang=en data-theme class=html><head><title>Osodo Rodney
|
H4: Second half of the 12-factor app</title><meta charset=utf-8><meta name=generator content="Hugo 0.109.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="Osodo Rodney"><meta name=description content="
      There must be a beginning of any great matter, but the continuing unto the end until it be thoroughly finished yields the true glory.


    "><meta name=google-site-verification content="rodneyosodo.com"><link rel=stylesheet href=/scss/main.min.b2e0cb07595e3519ab1193bb421914e06c0e26b0cc561fef23b3c6131d4d2ffa.css integrity="sha256-suDLB1leNRmrEZO7QhkU4GwOJrDMVh/vI7PGEx1NL/o=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/fontawesome.min.b1c4e6a10bdbab01f33fff9d78816ee68cf9a9a731f07668afd546a79924cb80.css integrity="sha256-scTmoQvbqwHzP/+deIFu5oz5qacx8HZor9VGp5kky4A=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.423dee17c62f55fa733a4ee13e00d523dfce88cc4f4ab4549a24ba36bd9de681.css integrity="sha256-Qj3uF8YvVfpzOk7hPgDVI9/OiMxPSrRUmiS6Nr2d5oE=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.b7d54133b27e5b4de15245b8e143de3e8ed2d674c706137274cedc9953f31917.css integrity="sha256-t9VBM7J+W03hUkW44UPePo7S1nTHBhNydM7cmVPzGRc=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=https://rodneyosodo.com/blogs/@rodneyosodo/h4-second-half-of-the-12-factor-app-b77b0fde6279/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/anatole-theme-switcher.min.738c0e3a493854876aeab9e2316fd43f1936aeeac4cc6b3e60bb26456dba72ad.js integrity="sha256-c4wOOkk4VIdq6rniMW/UPxk2rurEzGs+YLsmRW26cq0=" crossorigin=anonymous></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rodneyosodo.com/images/site-feature-image.png"><meta name=twitter:title content="H4: Second half of the 12-factor app"><meta name=twitter:description content="There must be a beginning of any great matter, but the continuing unto the end until it be thoroughly finished yields the true glory."><meta property="og:title" content="H4: Second half of the 12-factor app"><meta property="og:description" content="There must be a beginning of any great matter, but the continuing unto the end until it be thoroughly finished yields the true glory."><meta property="og:type" content="article"><meta property="og:url" content="https://rodneyosodo.com/blogs/@rodneyosodo/h4-second-half-of-the-12-factor-app-b77b0fde6279/"><meta property="og:image" content="https://rodneyosodo.com/images/site-feature-image.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2021-10-18T19:09:11+00:00"><meta property="article:modified_time" content="2021-10-18T19:09:11+00:00"><meta property="og:site_name" content="Rodney Osodo"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"blogs","name":"H4: Second half of the 12-factor app","headline":"H4: Second half of the 12-factor app","alternativeHeadline":"","description":"
      There must be a beginning of any great matter, but the continuing unto the end until it be thoroughly finished yields the true glory.


    ","inLanguage":"en","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/rodneyosodo.com\/blogs\/@rodneyosodo\/h4-second-half-of-the-12-factor-app-b77b0fde6279\/"},"author":{"@type":"Person","name":"Osodo Rodney"},"creator":{"@type":"Person","name":"Osodo Rodney"},"accountablePerson":{"@type":"Person","name":"Osodo Rodney"},"copyrightHolder":{"@type":"Person","name":"Osodo Rodney"},"copyrightYear":"2021","dateCreated":"2021-10-18T19:09:11.52Z","datePublished":"2021-10-18T19:09:11.52Z","dateModified":"2021-10-18T19:09:11.52Z","publisher":{"@type":"Organization","name":"Osodo Rodney","url":"https://rodneyosodo.com","logo":{"@type":"ImageObject","url":"https:\/\/rodneyosodo.com\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":["https://rodneyosodo.com/images/site-feature-image.png"],"url":"https:\/\/rodneyosodo.com\/blogs\/@rodneyosodo\/h4-second-half-of-the-12-factor-app-b77b0fde6279\/","wordCount":"1504","genre":[],"keywords":[]}</script></head><body class="body theme--light"><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src=/images/profile.png alt="profile picture"><div class=sidebar__introduction-title><a href=/>Rodney Osodo</a></div><div class=sidebar__introduction-description><p>This is Rodney Osodo's website</p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://www.linkedin.com/in/rodneyosodo rel=me aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://github.com/rodneyosodo rel=me aria-label=GitHub title=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://gitlab.com/0x6f736f646f rel=me aria-label=Gitlab title=Gitlab><i class="fab fa-gitlab fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://twitter.com/b1ackd0t rel=me aria-label=Twitter title=Twitter><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.instagram.com/rodneyosodo/ rel=me aria-label=Instagram title=Instagram><i class="fab fa-instagram fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.tiktok.com/@b1ackd0t rel=me aria-label=TikTok title=TikTok><i class="fab fa-tiktok fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.youtube.com/@rodneyosodo rel=me aria-label=Youtube title=Youtube><i class="fab fa-youtube fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://stackoverflow.com/users/9017060/black-dot rel=me aria-label=StackOverflow title=StackOverflow><i class="fab fa-stack-overflow fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://rodneyosodo.medium.com/ rel=me aria-label=Medium title=Medium><i class="fab fa-medium fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://open.spotify.com/show/2MBoVx1mlX0kjHVrooqasf rel=me aria-label=Spotify title=Spotify><i class="fab fa-spotify fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
2020-2023</li><li class=footer__item><a class=link href=/imprint/ title>imprint</a></li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script><script defer type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity=sha384-e/4/LvThKH1gwzXhdbY2AsjR3rm7LHWyhIG5C0jiRfn8AN2eTN5ILeztWw0H9jmN crossorigin=anonymous></script>
<script type=text/x-mathjax-config>
      MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>Home</a></li><li class=nav__list-item><a href=/blogs/ title>Blogs</a></li><li class=nav__list-item><a href=/portfolio/ title>Portfolio</a></li><li class=nav__list-item><a href=/publications/ title>Publications</a></li><li class=nav__list-item><a href=/talks/ title>Talks</a></li><li class=nav__list-item><div class=optionswitch><input class=optionswitch__picker type=checkbox id=menuoptionpicker hidden>
<label class=optionswitch__label class=optionswitch__label for=menuoptionpicker>Accomplishments <i class="fa fa-angle-down" aria-hidden=true></i></label><div class=optionswitch__triangle></div><ul class=optionswitch__list><li class=optionswitch__list-item><a href=/awards/ title>Awards</a></li><li class=optionswitch__list-item><a href=/certifications/ title>Certifications</a></li></ul></div></li><li class=nav__list-item><a href=/contact/ title>Contact</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__content><h1>H4: Second Half of the 12-Factor App</h1><blockquote><p>There must be a beginning of any great matter, but the continuing unto the end until it be thoroughly finished yields the true glory.</p></blockquote><blockquote><p><strong>- Francis Drake</strong></p></blockquote><blockquote><p><strong><em>The previous blog is at: “</em></strong><a href=https://rodneyosodo.medium.com/h3-first-half-of-the-12-factor-app-32f2783e29b1><strong>H3: First half of the 12-factor app</strong></a><strong><em>”</em></strong></p></blockquote><h3 id=7-portbinding>7. Port binding</h3><p><strong>80 & 8010</strong></p><p>The 12-factor application must be self-contained and bind to a port that is provided in the environment variable. It can’t rely on a web container like tomcat or unicorn being injected; instead, it must incorporate a server like jetty or thin. Requests from a public-facing hostname are sent through the execution environment to the port-bound web process.<br>With most embedded web servers, this is a simple task. If you’re already utilising an external web server, supporting an embedded server within your application may take extra effort.</p><p><img src=/images/blogimages/0__6oLWAXK6LHd4abUm.png alt></p><p>For the frontend application, IoT application, we are binding port 80 so that the end-user can interface with the IoT device web interface. This is so if they want to config the WIFI username and passwords or if they want to manually upgrade or downgrade the application version running in their device. This is done by the following.</p><p>WebServer server(80);</p><h4 id=i-rabbitmq>i. RabbitMQ</h4><p>RabbitMQ nodes bind to ports (open server TCP sockets) to accept client and CLI tool connections. Some of the available ports you can bind are:<br>- 5672, 5671: used by AMQP 0–9–1 and AMQP 1.0 clients without and with TLS<br>- 15672: HTTP API clients, management UI and rabbitmqadmin (only if the management plugin is enabled)<br>- 1883, 8883: MQTT clients without and with TLS, if the MQTT plugin is enabled<br>- 15675: MQTT-over-WebSockets clients (only if the Web MQTT plugin is enabled)<br>- 15692: Prometheus metrics (only if the Prometheus plugin is enabled)</p><p>rabbitmq:<br>build: rabbitmq/<br>image: mqtt-rabbitmq<br>container_name: &ldquo;mqtt&rdquo;<br>ports:<br>- &ldquo;15672:15672&rdquo;<br>- &ldquo;5672:5672&rdquo;<br>- &ldquo;1883:1883&rdquo;</p><h4 id=ii-influxdb>ii. InfluxDB</h4><p>Some open ports you can bind when using the InfluxDB service are:<br>- 8086: The default port that runs the InfluxDB HTTP service.<br>- 8088: The default port used by the RPC service for RPC calls made by the CLI for backup and restore operations (influxdb backup and influxdb restore)</p><p>Disabled ports<br>- 2003 The default port that runs the Graphite service. <br>- 4242 The default port that runs the OpenTSDB service.<br>- 8089 The default port that runs the UDP service.</p><p>influxdb:<br>image: influxdb:1.7-alpine<br>container_name: &ldquo;influxdb&rdquo;<br>ports:<br># The API for InfluxDB is served on port 8086<br>- &ldquo;8086:8086&rdquo;<br>- &ldquo;8082:8082&rdquo;<br># UDP Port<br>- &ldquo;8089:8089/udp"y</p><h4 id=iii-kapacitor>iii. Kapacitor</h4><p>Kapacitor exposes port 9092 which is the API port for the service.</p><p>kapacitor:<br>image: kapacitor:1.5-alpine<br>container_name: &ldquo;kapacitor&rdquo;<br>ports:<br># The API for Kapacitor is served on port 9092<br>- &ldquo;9092:9092&rdquo;</p><h4 id=iv-chronograf>iv. Chronograf</h4><p>Chronograf has a WebUI port which is `8888`. If you want to visualise your data you bind that port and open it when the application is running</p><p>chronograf:<br>image: chronograf:1.7-alpine<br>container_name: &ldquo;chronograf&rdquo;<br>ports:<br># The WebUI for Chronograf is served on port 8888<br>- &ldquo;8888:8888&rdquo;</p><h4 id=v-grafana>v. Grafana</h4><p>Grafana has a WebUI port which is `3000`. If you want to visualise your data you bind that port and open it when the application is running</p><p>grafana:<br>image: grafana/grafana:latest<br>container_name: &ldquo;grafana&rdquo;<br>ports:<br>- &lsquo;3000:3000&rsquo;</p><h4 id=vi-portainer>vi. Portainer</h4><p>Portainer has a WebUI port which is `8000` and `9443`. One of them is HTTPS while the other is HTTP. If you want to visualise your data you bind that port and open it when the application is running</p><p>portainer:<br>image: portainer/portainer-ce:latest<br>container_name: portainer<br>ports:<br>- &lsquo;8000:8000&rsquo;<br>- &lsquo;9443:9443&rsquo;</p><h4 id=vii-kibana>vii. Kibana</h4><p>Kibana has a WebUI port which is `5601`. If you want to visualise your data you bind that port and open it when the application is running</p><p>kibana:<br>build: kibana/<br>container_name: &ldquo;kibana&rdquo;<br>ports:<br>- &ldquo;5601:5601&rdquo;</p><h4 id=viii-logstash>viii. Logstash</h4><p>logstash:<br>build: logstash/<br>container_name: &ldquo;logstash&rdquo;<br>ports:<br>- &ldquo;5000:5000&rdquo;</p><h4 id=ix-elasticsearch>ix. Elasticsearch</h4><p>elasticsearch:<br>build: elasticsearch/<br>container_name: &ldquo;elasticsearch&rdquo;<br>ports:<br>- &ldquo;9200:9200&rdquo;<br>- &ldquo;9300:9300&rdquo;</p><h4 id=x-nginx>x. Nginx</h4><p>Nginx exposes port 80 you have to bind it to another port so that you can serve those requests through it.</p><p>nginx:<br>image: nginx:latest<br>container_name: &ldquo;nginx&rdquo;<br>ports:<br>- &ldquo;8080:80&rdquo;</p><h3 id=8-concurrency>8. Concurrency</h3><p>Keep your sessions in Redis or DB</p><p>Because a 12-factor solely employs stateless processes, it may expand out by adding processes. A 12-factor application can contain several process types, such as browser processes, background worker processes, or clock processes (for cron-like scheduled activities) (for cron-like scheduled jobs).<br>As each process type is scaled separately, each logical process would become its own Docker container as well. We’ve previously seen developing a web process; other processes are pretty similar. Scaling out usually only entails deploying new instances of the container. (However, scaling out the clock processes is typically not recommended because they frequently create events that you want to be scheduled as singletons inside your infrastructure.)</p><h3 id=9-disposability>9. Disposability</h3><p>Thank Docker and Makefile!</p><p>Processes in a 12-factor app can be launched or halted (with a SIGTERM) at any moment. As a result, reducing starting time and gracefully shutting down is critical. When a web service receives a SIGTERM, for example, it should cease listening on the HTTP port, wait for in-flight requests to complete, and then depart. Processes should be resistant to an unexpected death in the same way; for example, worker processes should have a robust queuing backend.<br>You should choose a web server that can gracefully shut down. This is one of the more difficult aspects of choosing a web server, at least for many of the popular Python HTTP servers I’ve tested.</p><p>GH_REPO = <a href=https://github.com/JKUATSES/2021-project-hack.git>https://github.com/JKUATSES/2021-project-hack.git</a><br>C_DIR = chronograf/<br>I_DIR = influxdb/<br>K_DIR = kapacitor/<br>G_DIR = grafana/</p><p>clean: stop remove-files</p><p>all: clean pull build start</p><p># This pull the images for the docker images<br>pull:<br>docker-compose pull<br># This builds any images which are supposed to be built while running docker compose<br>build:<br>docker-compose build<br># This starts up the containers. We change the read and write rights for the rabbitmq file the start it up<br>start:<br>chmod 755 rabbitmq/cluster-entrypoint.sh<br>docker-compose up -d<br># This stops the containers while maintaining their volumes<br>stop:<br>docker-compose down<br># This prunes the images containers, volumes and networks. It also removes the data files that were created when the docker containers spun up into existence<br>remove-files:<br>docker system prune -a<br>docker volume prune<br>[ -d $(C_DIR) ] && echo exists && rm -rf $(C_DIR) $(I_DIR) $(K_DIR) || echo not exists</p><p># This watches the conatiner logs<br>logs:<br>watch docker-compose logs<br># Removes the data bases and creates new directories<br>clear_db:<br>sudo rm -rf $(C_DIR)/data $(G_DIR)/data $(G_DIR)/provisioning $(I_DIR)/data $(K_DIR)/data elasticsearch/data logstash/data kibana/data<br>mkdir $(K_DIR)/data $(C_DIR)/data $(I_DIR)/data elasticsearch/data logstash/data kibana/data</p><h3 id=10-devprodparity>10. Dev/Prod parity</h3><p>Yup<br>The goal of a 12-factor app is to reduce the gap between development and production as short as possible. The amount of time code spends in development but not in production is reduced with continuous deployment. Developers can deploy their code in production, just as they do in their local development environments, using a self-serve platform. Using the same underpinning services (databases, caches, queues, etc) in development as production lowers the number of minor issues that emerge in discrepancies across technologies or integrations.</p><p><img src=/images/blogimages/0__uL8UeLZ4AH3EHUNR.jpg alt></p><h3 id=11-logs>11. Logs</h3><p>Yup<br>Consider logs to be a continuous stream of time-ordered events gathered from all active processes and services. A 12-factor app is unconcerned with how its output is processed. It just publishes its output to the stdout stream instead. This output is collected, collated, and routed to its eventual destination by the execution environment (s).<br>Most logging frameworks enable logging to stderr/stdout by default or provide a simple way to switch from file-based logging to one of these streams. The execution environment of a 12-factor programme is required to capture these streams and manage them as the platform mandates.</p><p>Elasticsearch, Logstash, and Kibana are the three open-source tools that make up the ELK Stack. The ELK stack offers centralised logging to help discover server or application issues. It allows you to search through all of your logs in one location. It also aids in the discovery of faults across several servers by linking logs during a specified period.</p><p>The letter E stands for ElasticSearch, which is a log storage system.<br>The letter L stands for LogStash, which is utilised for both transporting and processing and storing logs.<br>Kibana (pronounced “kibana”) is a visualisation tool (a web interface) that runs on Nginx or Apache.</p><p><img src=/images/blogimages/0__HWcryP3eJ__01Jakp.jpg alt></p><h3 id=12-admin-processes>12. Admin Processes</h3><p>Run admin/management tasks as one-off processes</p><p>Any 12-factor app administration or management activities should be executed as one-off processes within the deployment’s execution environment. This process runs against a release and utilises the same codebase and configurations as any other process in that release, as well as the same dependency isolation methods as the long-running processes.<br>This is a characteristic of the execution environment in which your programme runs. This may be simple if you’re using a Docker-like containerized solution.<br>We will be using portainer to manage our Admin processes</p><p><img src=/images/blogimages/0__eTsBSWehuyC8lP5I.png alt></p><p>If you liked this article, click the👏 multiple times below so other people will see it here on Medium.</p><p>Let’s be friends on <a href=https://twitter.com/b1ackd0t>Twitter</a>. Happy Coding 😉</p><h3 id=acknowledgement>Acknowledgement</h3><p>1. <a href=https://twitter.com/GituKelvin/>Kelvin Gitu</a></p><h4 id=next-blog-series-h5-recommendationshttpsrodneyosodomediumcomh5-recommendations-3caff50e8108>NEXT BLOG SERIES: <a href=https://rodneyosodo.medium.com/h5-recommendations-3caff50e8108>H5: Recommendations</a></h4></div><div class=post__footer></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
2020-2023</li><li class=footer__item><a class=link href=/imprint/ title>imprint</a></li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script><script defer type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity=sha384-e/4/LvThKH1gwzXhdbY2AsjR3rm7LHWyhIG5C0jiRfn8AN2eTN5ILeztWw0H9jmN crossorigin=anonymous></script>
<script type=text/x-mathjax-config>
      MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script></body></html>